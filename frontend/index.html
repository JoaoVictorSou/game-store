<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AXIOS</title>
</head>
<body>
    <ul id="games"></ul>

    <h4>Novo game</h4> 
    <form action="">
        <input type="text" placeholder="título" name="title" id="title">
        <input type="number" placeholder="ano" name="year" id="year">
        <input type="number" placeholder="preço" name="price" id="price">
        <input type="button" value="cadastrar" onclick="createGame()">
    </form>
    <hr>
    <h4>Editar game</h4> 
    <form action="" id="form-edit">
        <input type="text" placeholder="título" name="title" id="id-edit" readonly>
        <input type="text" placeholder="título" name="title" id="title-edit">
        <input type="number" placeholder="ano" name="year" id="year-edit">
        <input type="number" placeholder="preço" name="price" id="price-edit">
        <input type="button" value="editar" onclick="updateGame()">
    </form>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        //exibir
        axios.get('http://localhost:8080/games')
            .then(response => {
                let games = response.data
                let $games = document.getElementById('games')

                games.forEach(game => {
                    let $item = document.createElement('li')
                    let $btn_delete = document.createElement('button')
                    const $btn_edit = document.createElement('button')

                    $item.setAttribute('data-id', game.id)
                    $item.setAttribute('data-title', game.title)
                    $item.setAttribute('data-year', game.year)
                    $item.setAttribute('data-price', game.price)

                    $item.innerHTML = `${game.id} | ${game.title} - ${game.price} R$`
                    $btn_delete.innerHTML = 'deletar'
                    $btn_edit.innerHTML = 'editar'

                    $btn_delete.addEventListener('click', () => {
                        const id = $item.getAttribute('data-id')
                        
                        axios
                            .delete(`http://localhost:8080/game/${id}`)
                            .then(response => {
                                if (response.status === 200) {
                                    alert('deletado')
                                } else {
                                    alert('não foi deletado:', response.status)
                                }

                                window.location.reload()
                            })
                            .catch(err => {
                                console.log(err)
                            })
                    })

                    $btn_edit.addEventListener('click', () => {
                        const id = $item.getAttribute('data-id')
                        const title = $item.getAttribute('data-title')
                        const year = $item.getAttribute('data-year')
                        const price = $item.getAttribute('data-price')

                        const $id = document.getElementById('id-edit')
                        const $title = document.getElementById('title-edit')
                        const $year = document.getElementById('year-edit')
                        const $price = document.getElementById('price-edit')

                        $id.value = id
                        $title.value = title
                        $year.value = year
                        $price.value = price
                    })

                    $item.appendChild($btn_delete)
                    $item.appendChild($btn_edit)
                    $games.appendChild($item)
                })
            })
            .catch(err => {
                console.log(err)
            })
        //cadastrar
        async function createGame() {
            let $title = document.getElementById('title')
            let $year = document.getElementById('year')
            let $price = document.getElementById('price')

            let game = {
                title: $title.value,
                year: $year.value,
                price: $price.value
            }

            try {
                let response = await axios.post('http://localhost:8080/game', game)
                console.log(response.status)
                if (response.status === 201) {
                    alert('jogo cadastrado')
                } else {
                    alert('o jogo não foi cadastrado')
                }

                window.location.reload()
            } catch (err) {
                alert('ocorreu um erro:', err)
                console.log(err)
            }
        }

        //editar
        async function updateGame(){
            const $id = document.getElementById('id-edit')
            const $title = document.getElementById('title-edit')
            const $year = document.getElementById('year-edit')
            const $price = document.getElementById('price-edit')

            const game = {
                title: $title.value,
                year: $year.value,
                price: $price.value
            }

            try {
                const responde = await axios.put(`http://localhost:8080/game/${$id.value}`, game)

                if (responde.status === 200) {
                    alert('jogo editado')
                } else {
                    alert('jogo não foi editado:', responde.status)
                }

                window.location.reload()
            } catch (error) {
                console.log(error)
            }
        }
    </script>
</body>
</html>